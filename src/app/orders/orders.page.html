<ion-header translucent>
  <ion-toolbar>
    <ion-title>Open Orders</ion-title>
  </ion-toolbar>
  <ion-toolbar *ngIf="!isDesktop">
    <ion-searchbar #searchBar (ionInput)="getItems($event)"></ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen>

  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content
      pullingIcon="chevron-down-circle-outline"
      >
    </ion-refresher-content>
  </ion-refresher>


  <ion-list *ngIf="!isDesktop">
    <ion-item-sliding *ngFor="let order of ordersRep; let i = index" #slidingItem>
      <ion-item [routerLink]="[order.id]" (press)=selectItem(i)  [color]="(i % 2 === 0) ? '' : 'light'"> 
        <ion-label class="ion-text-capitalize">{{order?.numOrderId}} </ion-label>
        <p>{{order.items?.length}}</p>
        <!-- <ion-checkbox slot="end"></ion-checkbox> -->

      </ion-item>
  
      <div > 

        <ion-item-options side="start">
          <ion-item-option color="primary">
            <ion-icon name="boat" slot="icon-only"></ion-icon>
          </ion-item-option>
          <ion-item-option color="secondary">
            <ion-icon name="print-outline" slot="icon-only"></ion-icon>
          </ion-item-option>
          <ion-item-option color="tertiary">
            <ion-icon name="print-outline" slot="icon-only"></ion-icon>
          </ion-item-option>
        </ion-item-options>
        <ion-item-options side="end">
          <ion-item-option color="primary" (click)="presentActionSheet()">
            <ion-icon name="settings" slot="icon-only"></ion-icon>
          </ion-item-option>
          <ion-item-option color="danger" (click)="showDeleteAlert(order.id, slidingItem)">
            <ion-icon name="trash" slot="icon-only"></ion-icon>
          </ion-item-option>
         
      </ion-item-options>
      </div>
    </ion-item-sliding>
  </ion-list>
  
  <div *ngIf="isDesktop">
    <p-table 
    [value]="orders" 

    [scrollable]="true"
    scrollHeight="80vh"
    [style]="{width:'100%'}"
    [rowsPerPageOptions]="[50,100,200]" 
    [resizableColumns]="true"
    [reorderableColumns]="true"
    #dt>
    <ng-template pTemplate="colgroup" let-columns>
      <colgroup>
          <col *ngFor="let i of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42]" style="width:100px">
          
      </colgroup>
    </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th pResizableColumn rowspan="2" pSortableColumn="numOrderId">Order Number
                  <p-sortIcon field="numOrderId" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
                </th>
                <th pResizableColumn colspan="10">Totals</th>
                <th pResizableColumn colspan="11">Customer</th>
                <th pResizableColumn colspan="11">Items</th>
                <th pResizableColumn colspan="8">Shipping</th>
            </tr>
            <tr>
                <th>Currency</th>
                <th field="totalsInfo.subtotal">Subtotal
                  <p-sortIcon field="totalsInfo.subtotal" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>

                </th>
                <th>Total Charge</th>
                <th>Total Discount</th>
                <th>Tax</th>
                <th>Payment Method</th>
                <th>Country Tax Rate</th>
                <th>Conversion Rate</th>
                <th>Postage Cost</th>
                <th>Profit Margin</th>
  


                <th>Name</th>
                <th>Email</th>
                <th>Company</th>
                <th>Address1</th>
                <th>Address2</th>
                <th>Address3</th>
                <th>Phone No.</th>
                <th>Town</th>
                <th>Region</th>
                <th>Postcode</th>
                <th>Country</th> 

                <th>SKU</th>
                <th>Title</th>
                <th>Channel SKU</th>
                <th>Channel Title</th>
                <th>Category Name</th>
                <th>Bin Rack</th>
                <th>Available Stock</th>
                <th>Cost</th>
                <th>Cost Inc Tax</th>
                <th>Qantity</th>
                <th>Discount</th>  
          
                <th>Vendor</th>
                <th>Tracking Number</th>
                <th>Item Weight</th>
                <th>Total Weight</th>
                <th>Package Category</th>
                <th>Postage Cost</th>
                <th>Postage Cost Ex Tax</th>
                <th>Postal Service Name</th>
             
              
                <tr>
                  <th>
                      <input pInputText type="text" (input)="dt.filter($event.target.value, 'numOrderId', 'contains')">
                  </th>

                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'totalsInfo.currency', 'contains')">
                  </th>

                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'totalsInfo.subtotal', 'contains')">
                  </th>
                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'totalsInfo.totalCharge', 'contains')">
                  </th>
                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'totalsInfo.totalDiscount', 'contains')">
                  </th>
                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'totalsInfo.tax', 'contains')">
                  </th>
                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'totalsInfo.paymentMethod', 'contains')">
                  </th>
                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'totalsInfo.countryTaxRate', 'contains')">
                  </th>
                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'totalsInfo.conversionRate', 'contains')">
                  </th>
                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'totalsInfo.postageCost', 'contains')">
                  </th>
                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'totalsInfo.profitMargin', 'contains')">
                  </th>


                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'customerInfo.fullName', 'contains')">
                  </th>

                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'customerInfo.emailAddress', 'contains')">
                  </th>

                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'customerInfo.company', 'contains')">
                  </th>

                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'customerInfo.address1', 'contains')">
                  </th>

                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'customerInfo.address2', 'contains')">
                  </th>

                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'customerInfo.address3', 'contains')">
                  </th>

                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'customerInfo.phoneNumber', 'contains')">
                  </th>

                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'customerInfo.town', 'contains')">
                  </th>

                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'customerInfo.region', 'contains')">
                  </th>

                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'customerInfo.postCode', 'contains')">
                  </th>

                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'customerInfo.country', 'contains')">
                  </th>


                  <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'items[0].sku', 'contains')">
                  </th>
                </tr>
        </ng-template>
        <ng-template pTemplate="body" let-order let-rowNode>
            <tr>
              <td class="ui-resizable-column" [attr.rowspan]="order.items != null ? order.items.length : 1">
                {{order.numOrderId}}
              </td>
              <td class="ui-resizable-column" [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.totalsInfo.currency}}</td>
              <td class="ui-resizable-column" [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.totalsInfo.subtotal}}</td>
              <td class="ui-resizable-column" [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.totalsInfo.totalCharge}}</td>
              <td class="ui-resizable-column" [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.totalsInfo.totalDiscount}}</td>
              <td class="ui-resizable-column" [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.totalsInfo.tax}}</td>
              <td class="ui-resizable-column" [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.totalsInfo.paymentMethod}}</td>
              <td class="ui-resizable-column" [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.totalsInfo.countryTaxRate}}</td>
              <td class="ui-resizable-column" [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.totalsInfo.conversionRate}}</td>
              <td class="ui-resizable-column" [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.totalsInfo.postageCost}}</td>
              <td class="ui-resizable-column" [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.totalsInfo.profitMargin}}</td>


            
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.customerInfo.fullName}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.customerInfo.emailAddress}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.customerInfo.company}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.customerInfo.address1}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.customerInfo.address2}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.customerInfo.address3}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.customerInfo.phoneNumber}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.customerInfo.town}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.customerInfo.region}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.customerInfo.postCode}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.customerInfo.country}}</td>

                <td>{{order.items != null ? order.items[0].sku || '-' : ''}}</td>
                <td>{{order.items != null ? order.items[0].title || '-' : ''}}</td>
                <td>{{order.items != null ? order.items[0].channelSku || '-' : ''}}</td>
                <td>{{order.items != null ? order.items[0].channelTitle || '-' : ''}}</td>
                <td>{{order.items != null ? order.items[0].categoryName || '-' : ''}}</td>
                <td>{{order.items != null ? order.items[0].binRack || '-' : ''}}</td>
                <td>{{order.items != null ? order.items[0].availableStock || '-' : ''}}</td>
                <td>{{order.items != null ? order.items[0].cost || '-' : ''}}</td>
                <td>{{order.items != null ? order.items[0].costIncTax || '-' : ''}}</td>
                <td>{{order.items != null ? order.items[0].quantity || '-' : ''}}</td>
                <td>{{order.items != null ? order.items[0].discount || '-' : ''}}</td>


             
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.shippingInfo.vendor}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.shippingInfo.trackingNumber}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.shippingInfo.itemWeight}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.shippingInfo.totalWeight}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.shippingInfo.packageCategory}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.shippingInfo.packageCost}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.shippingInfo.packageCostExTax}}</td>
                <td [attr.rowspan]="order.items != null ? order.items.length : 1">{{order.shippingInfo.postalServiceName}}</td>


            </tr>

            <ng-container *ngIf="order.items != null && order.items.length > 0">
              <ng-container *ngFor="let item of order.items | slice:1;" >
                <tr>
                  <td>{{item.sku || '-'}}</td>
                  <td>{{item.title || '-'}}</td>
                  <td>{{item.channelSku || '-'}}</td>
                  <td>{{item.channelTitle || '-'}}</td>
                  <td>{{item.categoryName || '-'}}</td>
                  <td>{{item.binRack || '-'}}</td>
                  <td>{{item.availableStock || '-'}}</td>
                  <td>{{item.cost || '-'}}</td>
                  <td>{{item.costIncTax || '-'}}</td>
                  <td>{{item.quantity || '-'}}</td>
                  <td>{{item.discount || '-'}}</td>
                </tr>
                
              </ng-container>

              
            </ng-container>
            
        </ng-template>
    </p-table>

  </div>
  
</ion-content>
